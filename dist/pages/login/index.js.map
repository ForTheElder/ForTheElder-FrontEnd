{"version":3,"file":"pages/login/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAEA;AAEA;AAFA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAIA;;;;;;;;;;;;;ACnOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://theolder/._src_pages_login_index.jsx","webpack://theolder/./src/pages/login/index.jsx?afe4"],"sourcesContent":["import React,{ useState, useRef } from 'react'\r\nimport Taro from '@tarojs/taro'\r\nimport { View, Text, Input, Radio, Checkbox, Switch, Picker, Icon } from '@tarojs/components'\r\nimport './index.less'\r\n\r\nexport default function Login() {\r\n\r\n  const [selector] = useState([\r\n    '老人','学生'\r\n  ])\r\n  const [selected,setSelected] = useState('老人')\r\n  const [code,setCode] = useState('')\r\n\r\n  const [formState, setFormState] = useState(0)\r\n  const telRef1 = useRef(null)\r\n  const psRef1 = useRef(null)\r\n  const telRef2 = useRef(null)\r\n  const psRef2 = useRef(null)\r\n  const checkRef = useRef(null)\r\n\r\n\r\n  const select = (e) => {\r\n    setSelected(selector[e.detail.value])\r\n  }\r\n\r\n  async function login(){\r\n    if(formState===1){\r\n      setFormState(0)\r\n      return\r\n    }\r\n\r\n    let phone = ''\r\n    let password = ''\r\n\r\n    if(telRef1 && telRef1.current.value.length === 11){\r\n      phone = telRef1.current.value\r\n    }else return\r\n    \r\n    if(psRef1){\r\n      password = psRef1.current.value\r\n    }\r\n\r\n    const data = {\r\n      phone: phone,\r\n      password: password\r\n    }\r\n\r\n    const header = {\r\n      'content-type': 'application/json'\r\n    }\r\n\r\n    console.log(data)\r\n    Taro.request({\r\n      url: 'http://124.70.208.213:9001/user/user/login',\r\n      data,\r\n      method: 'POST',\r\n      header\r\n    }).then(\r\n      res => {\r\n        if(res.statusCode === 200){\r\n          console.log(res.statusCode);\r\n          console.log(res.data)\r\n          Taro.setStorageSync('token',res.data.token)\r\n          Taro.setStorageSync('type',res.data.type)\r\n          Taro.showToast({\r\n            title:'登录成功',\r\n            icon:'success',\r\n            duration: 2000\r\n          })\r\n          if(res.data.type === '0'){\r\n            Taro.reLaunch({url: '/pages/main/index'})\r\n          }else {\r\n            Taro.reLaunch({url: '/pages/stu_main/index'})\r\n          }\r\n        }\r\n        else if(res.statusCode === 500){\r\n          Taro.showToast({\r\n            title:'登录超时',\r\n            icon:'loading',\r\n            duration: 2000\r\n          })\r\n        }\r\n        else {\r\n          Taro.showToast({\r\n            title:'登录失败',\r\n            icon:'error',\r\n            duration: 2000\r\n          })\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  async function getCode(){\r\n    let phone = ''\r\n    if(telRef2 && telRef2.current.value.length === 11){\r\n      phone = telRef2.current.value\r\n    }else return\r\n\r\n    const header = {\r\n      'content-type': 'application/json'\r\n    }\r\n\r\n    Taro.request({\r\n      url: `http://124.70.208.213:9001/user/user/sendCode/${phone}`,\r\n      method: 'GET',\r\n      header,\r\n    }).then(res => {\r\n      console.log(res.statusCode);\r\n      if(res.statusCode === 200){\r\n        console.log(res.data)\r\n        setCode(res.data.code)\r\n      }\r\n    })\r\n  }\r\n\r\n  async function register(){\r\n\r\n    if(formState===0){\r\n      setFormState(1)\r\n      return\r\n    }\r\n\r\n    let phone = ''\r\n    let password = ''\r\n    console.log(11111)\r\n    let type = selected === '老人'?'0':'1'\r\n    console.log(22222)\r\n    if(telRef2 && telRef2.current.value.length === 11){\r\n      phone = telRef2.current.value\r\n    }else return\r\n    \r\n    if(psRef2 && psRef2.current.value){\r\n      password = psRef2.current.value\r\n    }else return\r\n\r\n\r\n\r\n    if(checkRef.current.value.toLowerCase() !== code.toLowerCase()) return\r\n\r\n    const data = {\r\n      phone: phone,\r\n      password: password,\r\n      code: code,\r\n      type: type\r\n    }\r\n\r\n    const header = {\r\n      'content-type': 'application/json'\r\n    }\r\n\r\n    console.log(data)\r\n\r\n    Taro.request({\r\n      url: 'http://124.70.208.213:9001/user/user/register',\r\n      data,\r\n      method: 'POST',\r\n      header,\r\n    }).then(res => {\r\n      if(res.statusCode === 200){\r\n        // console.log(res.statusCode);\r\n        // console.log(res.data)\r\n        Taro.showToast({\r\n          title:'注册成功',\r\n          icon:'success',\r\n          duration: 2000\r\n        })\r\n        setFormState(0)\r\n      }\r\n    })\r\n  }\r\n\r\n  return (\r\n      <View className='wrapper'>\r\n        {\r\n          formState === 0?\r\n          <View className='login-wrapper'>\r\n            <Text className='title'>登录</Text>\r\n            <View className='form'>\r\n              <View className='username'>\r\n                <Text>手机号:</Text>\r\n                <Input ref={telRef1} type='text' className='username-input' />\r\n              </View>\r\n              <View className='password'>\r\n                <Text>密码:</Text>\r\n                <Input ref={psRef1} type='password' className='password-input' />\r\n              </View>\r\n            </View>\r\n            <View className='btn'>\r\n              <View className='btn-login' onClick={login}>登录</View>\r\n              <View className='btn-register' onClick={register}>注册</View>\r\n            </View>\r\n          </View>\r\n          :\r\n          <View className='register-wrapper'>\r\n          <Text className='title'>注册</Text>\r\n          <View className='form'>\r\n            <View className='username'>\r\n              <Text>手机号:</Text>\r\n              <Input ref={telRef2} type='text' className='username-input' />\r\n            </View>\r\n            <View className='password'>\r\n              <Text>密码:</Text>\r\n              <Input ref={psRef2} type='password' className='password-input' />\r\n            </View>\r\n            <View className='check'>\r\n              <Text>验证码:</Text>\r\n              <Input ref={checkRef} type='text' className='check-input' />\r\n              <View className='getCode' onClick={getCode}>{code === ''?'获取验证码':code}</View>\r\n            </View>\r\n            <View className='type'>\r\n                <Text>用户类型</Text>\r\n                <View className='picker-wrapper'>\r\n                  <Picker className='picker' mode='selector' range={selector} onChange={select}>\r\n                    <View className='pick-view'>{selected}</View>\r\n                  </Picker>\r\n                </View>\r\n            </View>\r\n          </View>\r\n          <View className='btn'>\r\n            <View className='btn-login' onClick={login}>登录</View>\r\n            <View className='btn-register' onClick={register}>注册</View>\r\n          </View>\r\n        </View>\r\n        }\r\n      </View>\r\n  )\r\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js??ruleSet[1].rules[5].use[0]!./index.jsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/login/index', {root:{cn:[]}}, config || {}))\n\n\n"],"names":[],"sourceRoot":""}